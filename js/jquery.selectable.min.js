(function($){"use strict";$.fn.selectable=function(d){var f={'radio':false,'class':'selected','onChange':function(e){},'onSelected':function(e){}},jqversion=$.prototype.jquery.split('.'),onFunc=(jqversion[0]==="1"&&parseInt(jqversion[1],10)<9)?'live':'on',opts=$.extend(f,d),selector=this.selector,allSelected=false,that;that={elements:$(selector)[onFunc]('click',function(){var a=$(this).find('.selection-index'),is_selected=$(this).hasClass(opts['class']);if(opts.radio){$(selector).removeClass(opts['class']);$(selector).find(':radio').attr('checked',false);$(this).find(':radio').attr('checked',true)}else{var b=$(this).find(':checkbox');if(b.length>0){b.attr('checked',!b.attr('checked'))}}if(is_selected){$(a).remove()}else{$(this).append($('<input type="hidden" class="selection-index" value="'+that._itemsSelected().size()+'" />'))}$(this).toggleClass(opts['class']);if($(this).hasClass(opts['class'])){opts.onSelected($(this))}that.onChange()}),toggleSelectAll:function(){if(allSelected){this.deselectAll()}else{this.selectAll()}},selectAll:function(){this.deselectAll();$(selector).each(function(){$(this).addClass(opts['class'])});this.onChange()},deselectAll:function(){$(selector).each(function(){$(this).removeClass(opts['class'])});this.onChange()},removeSelected:function(){$(selector+'.'+opts['class']).each(function(){$(this).remove()});this.onChange()},onChange:function(){opts.onChange(this.data())},data:function(){var c=this._items().size(),selected=this._itemsSelected(),totalSelected=selected.size();allSelected=(c===totalSelected)&&c!==0;return{selected:selected.sort(function(a,b){return(parseInt($(a).find('.selection-index').val(),10)>parseInt($(b).find('.selection-index').val(),10))}),totalSelected:totalSelected,total:c,allSelected:allSelected}},refresh:function(){$(selector+' input[checked]').each(function(){$(this).parent().addClass(opts['class'])});this.onChange()},_items:function(){return $(selector)},_itemsSelected:function(){return $(selector+'.'+opts['class'])}};$(selector).find(':checked').each(function(){$(this).closest(selector).addClass(opts['class'])});that.onChange();return that}})(jQuery);
